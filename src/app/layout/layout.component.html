<div class="flex h-screen w-screen dark:bg-unifi-bg text-gray-900 dark:text-gray-100 layout_root overflow-hidden">
  <!-- Sidebar -->
  <aside class="transition-all duration-300 border-r flex-shrink-0" [class.w-64]="sidebarOpen" [class.w-16]="!sidebarOpen">
    <div class="flex items-center justify-between p-4">
      @if (sidebarOpen) {
        <span class="text-lg font-bold text-unifi-accent">ZigBee2MQTT UI</span>
      }
      <button (click)="toggleSidebar()" class="p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>

    <nav class="mt-4">
      <a routerLink="/dashboard" routerLinkActive="selected text-white" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
        <span class="material-symbols-outlined">dashboard</span>
        @if (sidebarOpen) {
          <span>Dashboard</span>
        }
      </a>
      <a routerLink="/devices" routerLinkActive="selected text-white" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
        <span class="material-symbols-outlined">router</span>
        @if (sidebarOpen) {
          <span>Devices</span>
        }
      </a>

      <a (click)="permitJoin()" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors cursor-pointer">
        <span class="material-symbols-outlined">join</span>
        @if (sidebarOpen) {
          <span>Permit Join</span>
        }
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 flex flex-col min-w-0">
    <!-- Topbar -->
    <header class="h-14 border-b layout_header flex items-center justify-between px-4 flex-shrink-0">
      <h1 class="text-lg font-semibold">{{ 'APP_TITLE' | translate }}</h1>

      @if (info()?.permit_join === true && info()?.permit_join_end) {
        <div class="flex items-center gap-2">Open {{ info()?.permit_join_end ?? 0 | timeTogo }}</div>
      }
      <div class="flex items-center gap-2">
        {{ host }}
      </div>
    </header>

    <!-- Page Content -->
    <section class="flex-1 overflow-y-auto p-6 bg-gray-50 layout_section scrollbar min-h-0">
      <router-outlet></router-outlet>
    </section>

    <section class="logSection flex-shrink-0" [class.logSection-closed]="!logViewOpen">
      <LogView [logViewOpen]="logViewOpen" (toggleLogView)="toggleLogView()"></LogView>
    </section>
  </main>

  <!-- Right Sidebar for Device Properties -->
  <aside
    class="transition-all duration-300 border-l overflow-hidden scrollbar flex-shrink-0"
    [class.w-[450px]]="rightSidebarOpen()"
    [class.overflow-y-auto]="rightSidebarOpen()"
    [class.w-0]="!rightSidebarOpen()"
  >
    @if (rightSidebarOpen()) {
      <app-deviceinspector style="flex: 1; /* Takes all available space */" (closed)="closeRightSidebar()"></app-deviceinspector>
    }
  </aside>
</div>

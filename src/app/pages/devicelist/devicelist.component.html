<div class="flex w-full">
  <div style="width: 270px">
    <app-searchinput (searchChange)="applySearch($event)"></app-searchinput>
    <div class="mt-2">
      <OptionPanelComponent title="{{ 'MANUFACTURER' | translate }}" [entities]="vendorList()" (optionsChanged)="vendorsSelectionChanged($event)"></OptionPanelComponent>
    </div>
    <div class="mt-2">
      <OptionPanelComponent title="{{ 'MODEL' | translate }}" [entities]="modelList()" [maxShown]="10" (optionsChanged)="modelSelectionChanged($event)"></OptionPanelComponent>
    </div>

    <div class="mt-2">
      <OptionPanelComponent
        title="{{ 'STATUS' | translate }}"
        [entities]="availabilityList()"
        [maxShown]="10"
        (optionsChanged)="availabilitySelectionChanged($event)"
      ></OptionPanelComponent>
    </div>
    <div class="mt-2">
      <OptionPanelComponent title="{{ 'POWER' | translate }}" [entities]="powerOptionList()" (optionsChanged)="powerSelectionChanged($event)"></OptionPanelComponent>
    </div>
  </div>
  <div class="w-full ml-2">
    <TableComponent [dataSource]="datasource" [config]="tableConfig()" (sortChange)="onSort($event)" (rowClick)="selectDevice($event.ieee_address)">
      <!-- Status cell -->
      <ng-template appTableCell="status" let-device>
        <div class="flex ml-2">
          <span
            class="statusIcon"
            [class.red]="device.state.availability !== 'online'"
            [class.green]="device.state.availability === 'online'"
            [class.yellow]="device.state.availability === ''"
          ></span>
        </div>
      </ng-template>

      <!-- Icon cell -->
      <ng-template appTableCell="icon" let-device>
        <DeviceImage [device]="device" class="icon" width="25px"></DeviceImage>
      </ng-template>

      <!-- Name cell -->
      <ng-template appTableCell="name" let-device>
        {{ device.friendly_name }}
      </ng-template>

      <!-- Vendor cell -->
      <ng-template appTableCell="vendor" let-device>
        {{ device.definition?.vendor || '' }}
      </ng-template>

      <!-- Model cell -->
      <ng-template appTableCell="model" let-device>
        {{ device.definition?.model || '' }}
      </ng-template>

      <!-- Link Quality cell -->
      <ng-template appTableCell="linkquality" let-device>
        {{ device.state?.linkquality ?? '??' }}
      </ng-template>

      <!-- Battery cell -->
      <ng-template appTableCell="battery" let-device>
        @if (device.power_source && device.power_source.indexOf('Battery') > -1) {
          @if (device.state) {
            <span
              class="statusIcon"
              [class.red]="device.state.availability !== 'online'"
              [class.green]="device.state.availability === 'online'"
              [class.yellow]="device.state.availability === ''"
            ></span>
          </div>
        </td>
      </ng-container>

      <!-- Last Seen cell -->
      <ng-template appTableCell="lastseenhuman" let-device>
        {{ device.state?.lastseenhuman || '--' }}
      </ng-template>
    </TableComponent>
  </div>
</div>

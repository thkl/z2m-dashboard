@if (reportings().length === 0) {
  <div class="report_row">
    <p class="label">No reportings found</p>
  </div>
} @else {
  @for (rep of reportings(); track rep.index) {
    <div class="reporting">
      <div class="report_row">
        <span class="label">{{ 'ENDPOINT' | translate }}</span>
        <span class="value">{{ rep.endpoint }}</span>
      </div>
      <ng-container *ngTemplateOutlet="reportingForm; context: { rep: rep, showDeactivate: true }"></ng-container>
    </div>
  }
}
<div class="reporting">
  <div class="report_row flex-row">
    <span class="label w-1/3">{{ 'SELECT_ENDPOINT' | translate }}</span>
    <div class="value w-2/3">
      <DropdownComponent [items]="deviceEndpointSelections()" (selected)="add($event)"></DropdownComponent>
    </div>
  </div>
  @if (newReporting()!.endpoint) {
    <ng-container *ngTemplateOutlet="reportingForm; context: { rep: newReporting(), showDeactivate: false }"></ng-container>
  }
</div>

<ng-template #reportingForm let-rep="rep" let-showDeactivate="showDeactivate">
  <div class="report_row flex-row">
    <span class="label w-1/3">{{ 'CLUSTER' | translate }}</span>
    <div class="value w-2/3">
      <DropdownComponent title="{{ 'CLUSTER' | translate }}" [items]="rep.visualClusterList" (selected)="changeCluster(rep.index, $event)"></DropdownComponent>
    </div>
  </div>

  @if (rep.cluster) {
    <div class="report_row flex-row">
      <span class="label w-1/3">{{ 'ATTRIBUTES' | translate }}</span>
      <div class="value w-2/3">
        <DropdownComponent
          title="{{ 'ATTRIBUTES' | translate }}"
          [items]="attributesForCluster(rep.cluster, rep.attribute)"
          (selected)="changeAttribute(rep.index, $event)"
        ></DropdownComponent>
      </div>
    </div>
    <div class="report_row flex-row">
      <span class="label w-1/3">{{ 'MIN_REPORT_INT' | translate }}</span>
      <div class="value w-2/3">
        <input
          id="min_report_change"
          class="w-full text-right"
          [value]="rep.minimum_report_interval"
          [disabled]="requestRunning()"
          (change)="changeMinRep(rep.index, $event.target.value)"
        />
      </div>
    </div>
    <div class="report_row flex-row">
      <span class="label w-1/3">{{ 'MAX_REPORT_INT' | translate }}</span>
      <div class="value w-2/3">
        <input
          id="max_report_interval"
          class="w-full text-right"
          [value]="rep.maximum_report_interval"
          [disabled]="requestRunning()"
          (change)="changeMaxRep(rep.index, $event.target.value)"
        />
      </div>
    </div>
    <div class="report_row flex-row">
      <span class="label w-1/3">{{ 'MIN_REPORT_CHG' | translate }}</span>
      <div class="value w-2/3">
        <input
          id="min_report_change"
          class="w-full text-right"
          [value]="rep.reportable_change"
          [disabled]="requestRunning()"
          (change)="changeMinRepChange(rep.index, $event.target.value)"
        />
      </div>
    </div>
    <div class="report_row flex-row">
      <div [class]="showDeactivate ? 'button w-1/2' : 'button w-full'">
        <button class="button-link left" [disabled]="requestRunning()" (click)="configureReporting(rep.index)">{{ 'UPDATE_REPORTING' | translate }}</button>
      </div>
      @if (showDeactivate) {
        <div class="button w-1/2">
          <button class="button-link-danger left" [disabled]="requestRunning()" (click)="deactivateReporting(rep.index)">{{ 'DEACTIVATE_REPORTING' | translate }}</button>
        </div>
      }

      <div class="indicator_container">
        @if (requestRunning() === true) {
          <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" class="icon-overlay" fill="#e3e3e3">
            <path
              d="M480-520q66 0 113-47t47-113v-120H320v120q0 66 47 113t113 47ZM160-80v-80h80v-120q0-61 28.5-114.5T348-480q-51-32-79.5-85.5T240-680v-120h-80v-80h640v80h-80v120q0 61-28.5 114.5T612-480q51 32 79.5 85.5T720-280v120h80v80H160Z"
            />
          </svg>
        }
      </div>
    </div>
  }
</ng-template>
